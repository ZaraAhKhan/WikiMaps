<!DOCTYPE html>
<html lang="en">

<head>
  <title>Wiki Maps-Home Page</title>

  <link rel="stylesheet" href="/vendor/normalize-4.1.1.css" type="text/css" />
  <link rel="stylesheet" href="/vendor/border-box.css" type="text/css" />

  <!-- App CSS -->
  <link rel="stylesheet" href="/styles/main.css" type="text/css" />
  <link rel="stylesheet" href="/styles/layout.css" type="text/css" />
  <link rel="stylesheet" href="/styles/header.css" type="text/css" />

  <!-- Bootstrap CSS-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin="" />

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""></script>


  <!-- App JS -->
  <script type="text/javascript" src="/vendor/jquery-3.0.0.js"></script>
  <script type="text/javascript" src="/scripts/app.js"></script>
</head>

<body>
  <%- include('partials/_header') %>

  <div class="container mt-4">
    <p class="hack"><%= JSON.stringify(mapData) %></p>
    <h1>Map: <%= mapData[0].title %></h1>
    <div id="map">
      <script>
        const mapData = JSON.parse(document.querySelector('.hack').innerHTML);
        console.log(mapData);
        const map = L.map('map').setView([43.657572963908336, -79.41145185759068], 12);

        // google map tile
        L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
          maxZoom: 18,
          subdomains: ['mt0', 'mt1', 'mt2', 'mt3'],
        }).addTo(map);

        const newIcon = L.icon({
          iconUrl: '/images/red-marker-icon.png',

          iconSize: [48, 48],
          iconAnchor: [24, 50],
          popupAnchor: [0, -40]
        })

        for (let i = 0; i < Object.keys(mapData).length; i++) {
          marker = new L.marker([mapData[i].latitude, mapData[i].longitude], {
              icon: newIcon
            })
            .bindPopup(
              `
              <h6>${mapData[i].point_name}</h6>
            <p>${mapData[i].point_description}</p>
            `)
            .addTo(map);
        }

        // adds popup with lat and long
        const popup = L.popup();

        function onMapClick(e) {
          popup
            .setLatLng(e.latlng)
            .setContent(`You clicked the map at ${e.latlng.toString()}`)
            .openOn(map);

          console.log(e.latlng);
        }
        map.on('click', onMapClick);

      </script>



    </div>
    <div class="map-content">
      <div class="map-info">
        <h2>About Map</h2>
        <p><%= mapData[0].description %></p>
      </div>
      <div class="map-form">
        <h3>Add Point</h3>
        <form action="" method="post" class="map-form">
          <input type="text" name="point-title" id="point-title">
          <input type="text" name="point-description" id="point-description">
          <button type="button" class="btn btn-primary">Submit</button>
        </form>
      </div>
    </div>

  </div>

  <%- include('partials/_footer') %>
</body>

</html>
